<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Iqra University -- Users</title>

    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="/resources/static/css/adminlte/all.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="/resources/static/css/adminlte/adminlte.min.css">

    <link rel="stylesheet" href="/resources/static/css/bootstrap-table.css">
    <link rel="stylesheet"
          href="/resources/static/css/bootstrap-datepicker.css">


</head>
<body class="hold-transition layout-top-nav">
<div class="wrapper">

    <!-- Navbar -->
    <div th:replace="/fragments/topnavbar :: nav"></div>
    <!-- /.navbar -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container">

                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0"> IQRA University ORIC</small></h1>
                    </div><!-- /.col -->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item"><a href="#">Layout</a></li>
                            <li class="breadcrumb-item active">Top Navigation</li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
    <div class="container-xl" style="height: 500px">
        <div class="row mb-2">
            <div class="col-md-6">
                <button id="addUser" class="btn-primary">Add</button>
            </div>
        </div>
        <div class="row justify-content-left"
             style="margin-left: 10px; margin-top: 5px">
            <table style="font-size: 14px;"
                   class="table table-hover  table-bordered table-sm table-responsive-sm mx-auto greenTable"
                   id="dataTable" data-unique-id="id" data-use-row-attr-func="true"

            >
            </table>
        </div>
    </div>
        <div id="dataModal" class="modal fade" role="dialog"
             aria-labelledby="myExtraLargeModalLabel" aria-hidden="true"
             data-keyboard="false">
            <div class="modal-dialog modal-lg" >

                <!-- Modal content-->
                <div class="modal-content">

                    <div class="modal-body  ui-front" id="modalBody">


                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Salutation</label>
                                        <select class="form-control select2" style="width: 100%;" id="userSalutation">
                                            <option selected="selected" value="mr">Mr.</option>
                                            <option value="ms">Ms.</option>
                                            <option value="mrs">Mrs.</option>
                                            <option value="engr">Engr.</option>
                                            <option value="dr">Dr.</option>
                                            <option value="prof">Prof.</option>
                                            <option value="engrdr">Engr. Dr.</option>
                                            <option value="profengrdr">Prof. Engr. Dr.</option>
                                            <option value="profdr">Prof. Dr.</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>First Name</label>
                                        <input id="userFirstName" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Middle Name</label>
                                        <input id="userMiddleName" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Last Name</label>
                                        <input id="userLastName" class="form-control">
                                    </div>
                                </div>
                            </div>
                        <div class ="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input id="userEmail" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Phone</label>
                                    <input id="userPhone" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Mobile</label>
                                    <input id="userMobile" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Permanent Status</label>
                                    <select class="form-control select2" style="width: 100%;" id="userPermanentStatus">
                                        <option selected="selected" value="fulltime">Full-Time</option>
                                        <option value="temporary">Temporary</option>
                                        <option value="parttime">Part-Time</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class ="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Qualification Level</label>
                                    <select class="form-control select2" style="width: 100%;" id="userQLevel">
                                        <option selected="selected" value="bachelors">Bachelors</option>
                                        <option value="masters">Masters</option>
                                        <option value="doctorate">Doctorate</option>
                                        <option value="mbbs">M.B.B.S</option>
                                        <option value="llb">L.L.B</option>
                                    </select>

                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Qualification Title</label>
                                    <input class="form-control select2" style="width: 100%;" id="userQTitle">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>CNIC</label>
                                    <input id="userCnic" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Personal URL</label>
                                    <input id="userPUrl" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class ="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Field of Study</label>
                                    <input class="form-control " style="width: 100%;" id="userFStudy">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Date of Birth</label>
                                    <input class="form-control dateInput" style="width: 100%;" id="userDOB">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>Joinning Date</label>
                                    <input class="form-control dateInput" style="width: 100%;" id="userJDate">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger mr-auto"
                                id="userSaveButton" >Save</button>
                    </div>
                </div>
            </div>
        </div>
    <!-- /.content-wrapper -->
    <input type="hidden" id="userId">
    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->

    <!-- Main Footer -->
    <footer class="main-footer">
        <!-- To the right -->
        <div class="float-right d-none d-sm-inline">
            Anything you want
        </div>
        <!-- Default to the left -->
        <strong>Copyright &copy; 1998-2022 Iqra University.</strong> All rights reserved.
    </footer>
</div>
</div>

</body>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="/resources/static/js/jquery-3.6.0.js"></script>
<script src="/resources/static/js/jquery-ui.min.js"></script>
<!-- Bootstrap 4 -->
<script src="/resources/static/js/bootstrap.bundle.js"></script>
<!-- AdminLTE App -->
<script src="/resources/static/js/adminlte/adminlte.min.js"></script>
<script src="/resources/static/js/bootstrap-table.js"></script>
<script src="/resources/static/js/bootstrap-datepicker.min.js"></script>
<script src="/resources/static/js/select2.full.min.js"></script>
<script>

    const $table = $("#dataTable");
    $(document).ready(function() {
        initializeLinks();
        initializeTable();
    });

    function initializeLinks(){
        $("#linkUsers").click(function(){
            window.location.href = "/universityAdmin/showUsers"
        });
        $("#addUser").click(function (){
            $("#dataModal").modal('show');
            $('#dataModal').on('shown.bs.modal', function() {
                $('.dateInput').datepicker({

                    dateFormat: "mm/dd/yyyy",
                    todayBtn: true,
                    todayHighlight: true,
                    container: '#modalBody'
                });
            });
        })
        $("#userSaveButton").unbind();
        $("#userSaveButton").on('click',function(){
            let dto = makeDtoFromForm();
            $.ajax({
                type : "POST",
                url : "/universityAdmin/saveUser",
                data : JSON.stringify(dto),
                // You are expected to receive the generated JSON (json_encode($data))
                beforeSend : function(){

                },
                complete:function(){
                },
                contentType: "application/json",
                success : function(data) {
                    let r =  $table.bootstrapTable('getRowByUniqueId', data.id);
                    if(r == null)
                     $table.bootstrapTable('insertRow', {index: 0, row: data});
                    else {
                        $table.bootstrapTable('updateByUniqueId', {id: data.id, row: data})
                    }
                    $("#dataModal").modal('hide');
                },
                error : function(er) {

                }
            });
        });
    }

    function populateFields(userDTO){
        let dto = new Object();
        if(typeof userDTO === 'undefined' || userDTO == null){
          dto =  getEmptyDTO();
        }
        else{
            dto = userDTO;
        }

          $("#userId").val(dto.id);
          $("#userSalutation").val(dto.salutation);
          $("#userFirstName").val(dto.firstName);
          $("#userMiddleName").val(dto.middleName);
          $("#userLastName").val(dto.lastName);
          $("#userEmail").val(dto.email);
          $("#userPhone").val(dto.phone);
          $("#userMobile").val(dto.mobile);
          $("#userPermanentStatus").val(dto.permanentStatus);
          $("#userQLevel").val(dto.qualificationLevel);
          $("#userQTitle").val(dto.qualificationTitle);
          $("#userCnic").val(dto.cnic);
          $("#userPUrl").val(dto.personalUrl);
             $("#userFStudy").val( dto.fieldOfStudy);
          $("#userDOB").val(dto.dob);
          $("#userJDate").val(dto.joinningDate);
    }
    const columns = [{
        field: 'id',
        align: 'right',
        valign: 'middle',
        width: '10',
        checkbox:false,
        title:'Select'
    },
        {
            field: 'name',
            width: '200',
            title:'Name'
        },
        {
            field: 'email',
            width: '90',
            title:'Email'
        },
        {
            field: 'permanentStatus',
            width: '90',
            title:'Permanent Status'
        },
        {
            field: 'cnic',
            width: '50',
            title:"CNIC"
        },
        {
            field: 'qualificationTitle',
            width: '20',
            title:'Qualification Title'
        },
        {
            field: 'qualificationLevel',
            width: '50',
            title:'Qualification Level'
        },
        {
            field: 'fieldOfStudy',
            width: '50',
            title:'Field Of Study'
        },
        {
            field: 'actions',
            width: '50',
            title: 'Actions',
            formatter: function(value, row, index, field) {
                let actions = [];
                actions.push('<div  col_name="actions"  class="action_tabs">');
                actions.push('<span class="fas fa-edit edit" ></span>');

                // actions.push('<i class="fa fa-trash delete_purchase"></i>');
                //actions.push('<a  class="fa fa-save save_purchase" aria-hidden="true" id='+row.purchaseId+'/>');
                actions.push('</div>');
                return actions.join("")
            },
            events: {

                'click .delete_purchase': function(e, value, row, index) {
                }
                ,
                'click .edit': function(e, value, row, index) {
                    populateFields(row);
                    $("#dataModal").modal('show');
                }

            }
        }];

    function initializeTable(){
        //
        $table.bootstrapTable({
            url: "/universityAdmin/getUsers",
            columns: columns,
            search : true
        })
    }

    function makeDtoFromForm(){
        let dto = new Object();
        dto.id = $("#userId").val();
        dto.salutation = $("#userSalutation").val();
        dto.firstName = $("#userFirstName").val();
        dto.middleName = $("#userMiddleName").val();
        dto.lastName = $("#userLastName").val();
        dto.email = $("#userEmail").val();
        dto.phone = $("#userPhone").val();
        dto.mobile = $("#userMobile").val();
        dto.permanentStatus = $("#userPermanentStatus").val();
        dto.qualificationLevel = $("#userQLevel").val();
        dto.qualificationTitle = $("#userQTitle").val();
        dto.cnic = $("#userCnic").val();
        dto.personalUrl = $("#userPUrl").val();
        dto.fieldOfStudy = $("#userFStudy").val();
        dto.dob = $("#userDOB").val();
        dto.joinningDate = $("#userJDate").val();
        return dto;
    }

    function getEmptyDTO(){
        let dto = new Object();

        dto.id = "";
        dto.salutation = "";
        dto.firstName = "";
        dto.middleName = "";
        dto.lastName = "";
        dto.email = "";
        dto.phone = "";
        dto.mobile = "";
        dto.permanentStatus = "";
        dto.qualificationLevel = "";
        dto.qualificationTitle = "";
        dto.cnic = "";
        dto.personalUrl = "";
        dto.fieldOfStudy = "";
        dto.dob = "";
        dto.joinningDate = "";
        return dto;
    }

</script>
</html>
